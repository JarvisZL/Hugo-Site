# 图形设备输出原理


## 图形输出颜色模型

### 颜色模型问题
- <font color=red size=3>颜色模型</font>：在特定上下文中对颜色的特性和行为的解释方法
  - 没有一种颜色模型能够解释所有的颜色问题
  - 一种颜色模型只能表征一定的颜色范围
  - 要使用不同模型来帮助说明能看到不同的颜色特征。

### 颜色模型的光颜色提醒
- 光源用白色来描述
  - <font color=red size=3>互补色</font>：混合成白色光的两种彩色光源
- 适当选择两种或多种初始颜色可形成其他颜色
  - <font color=red size=3>基色</font>：用来生成其他颜色的两种或三种颜色。
  - <font color=red size=3>颜色范围</font>：使用基色获得一定范围

### 颜色匹配公里
- 基色/原色：任意<font color=blue size=3>互不相关的三种颜色</font>构成颜色空间的一组基色
  - 任意两种组合不产生另一种颜色
  - 三基色通过适当的混合可以产生一定范围内所有的颜色。
- 常用三基色RGB
  - 任意一种颜色F表达式$F = R[R] + G[G] + B[B]$(加权和)
  - 亮度是其分亮度之和$Y_F = RY_R + GY_G + BY_B$

### 颜色特性描述
- 色彩/色度：基本色彩
- 纯度/彩度或者饱和度：颜色表现多纯
  - 加入白色可以降低饱和度
- 明度/亮度：单位时间，角度及投射面上光源辐射的能量
- 三者关系：
  - 明度：沿着颜色空间的中心线变化
  - 色度：沿着圆周方向变化
  - 纯度：沿着半径变化
  - ![](/images/documents/计算机图形学/明度色度纯度.png)

### CIE标准XYZ颜色模型
- 各种颜色的加色空间：XYZ是三基色，是虚颜色。
- 任意一个颜色可以表示为XYZ的加权和。
- CIE-XYZ的特别选取：
  - 颜色XYZ空间归一化平面来度量色度：
    - $X+Y+Z= 1$
  - 颜色坐标分量Y设为其亮度值

#### 标准函数
- 规范化基色权向量(X,Y,Z)可以得到

  <div>
  $$\begin{cases}
     X = \dfrac{X}{X+Y+Z}\\
     Y = \dfrac{Y}{X+Y+Z}\\
     Z = \dfrac{Z}{X+Y+Z}
  \end{cases}$$
  </div>

  - 坐标(x,y,z)在$X+Y+Z = 1$平面上
  - 原点与点(x,y,z)连接线上所有颜色$\rightarrow$ 色彩和纯度
  - 色度坐标(x,y)$\rightarrow$决定了颜色的色彩和纯度两个参数
  - 通常需要增加一个亮度Y来确定颜色—$(x,y,Y)$：
    $$X = \dfrac{x}{y}Y,\quad Y= Y,\quad Z = \dfrac{1-x-y}{y}Y$$


#### 色度图
- 将$X+Y+Z=1$平面投影到XY平面上，可见光谱中颜色的色度图:  x和y
- 舌头状曲线：边界和内部表示所有可见光色度值
- 边界上的点：对应于色纯度为100%的纯彩色
- 内部点: 所有可能的可见颜色组合
- C点：对应于照明体白色位置
  - 色度坐标近似$(1/3,1/3,1/3)$
- 紫红线：连接红色和紫色点的直线(不在可见光)

#### 颜色范围
- 两点的颜色范围是直线
  - 直线上的点到选定两端点的距离表示两种颜色混合的多少。
- 三点的颜色范围是三角形。
- 在色度图中不可能有一个三角形包含所有颜色。

#### 颜色特性
- 互补色：色度图上位于C点两侧且通过C的直线上的两个点$C_3,C_4$
- 二基色颜色范围可确定一种颜色的主波长和颜色纯度
  - $C$与$C_1$连线交边界于$C_s$,颜色$C_1$可以表示为白色光$C$和光谱颜色$C_s$的混合，主波长就是$C_s$
  - 纯度可以通过$dis(C,C_1),dis(C,C_s)$的比率来确定。
  - $C$与$C_2$连线交紫红线于点$C_p$其不在可见光谱内，其波长位于光谱曲线上的$C_{sp}$即$C_p$补点(反向延长线交于边界)

### CIE lab 模型
- 基于人对颜色的感觉。
- 用亮度或明度成分(L)及两个色度成分描述颜色
  - a成分：红色到绿色的变化
  - b成分：黄色到蓝色的变化
  - a,b的值域：+120到-120

### RGB模型
- 是一种加色模型
  - 绝大多数可见光谱可以用红绿蓝三色光的混合表示
  - 将光谱光线以各种不同的组合混合可以产生加色
  - 将所有颜色加在一起得到白色。
- RGB模型用一个单位立方体表示。
  - ![](/images/documents/计算机图形学/RGB.png)


### CMY模型
- 用青，品红，黄三基色描述设备输出，是一种减色模型，通过油墨吸收光线来生成减色。
  - ![](/images/documents/计算机图形学/CMY.png)
- CMYK模型
  - 添加黑色油墨，理论上所有颜色混合可以得到黑色，但是由于油墨杂质，所以为土棕色，所以添加黑色

### HSV模型
- 彩色和黑白颜料混合获得各种明暗，色泽和色调
  - 往彩色中加黑色获得不同明暗的彩色。
  - 往彩色里加白色获得不同色泽的彩色。
  - 往彩色里同时加黑白获得彩色色调
- 模型参数：色彩(H)，饱和度(S)，明度值(V)。
  - 加白色：参数S减小$(0\leq S\leq 1)$，$V=1$保持不变，生成不同色泽
  - 加黑色: 参数V减小$(0\leq V\leq 1)$, $S=1$保持不变，调节明暗
  - 同时添加：两个参数都减小，指定色调
  - ![](/images/documents/计算机图形学/HSV.png)
  - 色彩(H)：位于六边形顶点，六种纯色，60度间隔，互补色互为180度
  - 饱和度(S): 沿着水平轴测量，从0-1变化
  - 明度(V): 沿着中心垂直轴测量，锥顶点表示黑色
  - 六棱锥顶部的颜色强度最大，当$V=1,S=1$是纯色彩，白色是$V=1,S=0$的点。

### HLS模型
- 参数：色彩(H)，亮度(L)，饱和度(S)
- <img src="/images/documents/计算机图形学/HLS.png" style="zoom: 60%">

### 小结
- 可见光颜色的三个基本特征：色度，纯度和饱和度
- 面向计算：Lab模型，面向设备：RGB和CMY模型，面向用户: HSV和HLS模型

## 图形扫描显示原理
- 分为光栅扫描显示和随机扫描显示
- 图形显示的基本要素：扫描+刷新

### 光栅扫描图形显示原理
- 从左到右，自上而下地逐个像素访问和设置
  - 扫描线：从左到右扫描的像素，扫描线=每个水平方向的像素集。
  - 图像帧：自上而下的全屏扫描，图像帧=屏幕所有扫描线集。
  - 屏幕刷新：全屏扫描循环，刷新频率=单位时间的循环帧数，一般为每秒60-80帧
- 像素点颜色设置
  - 背景像素设置为背景色，形成图形背景
  - 前景像素设置为图形颜色，形成图新
- 刷新频率和显示质量和物体复杂度无关

### 光栅扫描图形显示的过程描述
- 基本指令
  - $read(I,x,y,z)$: 读存储器位置I中的内容z
    - x和y：有I确定的像素点位置
    - z：颜色值或灰度等级值
  - $write(x,y,z)$：屏幕上对应位置(x,y)显示内容z
- 基本过程
  - 读取存储器内的内容，并给屏幕位置对应的像素赋值
    - 对所有存储器的单元I循环执行$read(I,x,y,z),write(x,y,z)$
  - 屏幕刷新：每执行一次循环。


### 光栅扫描图形显示的扫描方式
- 逐行扫描
  - 逐行扫描扫描线
  - 水平回扫：扫描线之间的切换
  - 垂直回扫：帧间切换
  - ![](/images/documents/计算机图形学/逐行扫描.png)
- 隔行扫描
  - 帧显示分两趟
  - ![](/images/documents/计算机图形学/隔行扫描.png)

### 光栅扫描显示的帧缓冲器
- 存储器：存放屏幕像素的颜色信息
  - 帧缓冲器
  - 刷新存储器
- 帧缓冲器对屏幕的每一像素都有存储其灰度强度或颜色信息的能力，
  - 帧缓冲器的存储单元个数至少和显示器能够显示的像素总数相同，且对应于可寻址的屏幕像素位置。
- 位图(bitmap)
  - 二值/黑白显示系统的每一个像素需要一个二进位表示屏幕像素亮度。
- 像素图(pix-map)
  - 彩色/单色多灰度显示系统的每个像素需要多个二进位表示屏幕像素颜色及其可变强度。
- 帧缓冲器对颜色的控制： 
  - 帧缓冲器每个存储单元的位长
    - 如果为n，那么帧缓冲器能支持一幅画面同时显示的灰度等级和颜色种类为$\textcolor{red}{2^n}$,全彩色或者真彩色系统每个像素对应的单位位长为24位
- 显示器实际颜色显示
  - A: 一幅画面同时显示的灰度等级或颜色种类数
  - B: 显示器能显示的灰度等级或颜色种类数
  - C: 显示器的物理屏幕像素总数
  - 无彩色表：$A=B$,实际显示取$min(A,C)$
  - 有彩色表：$B\geq A$,实际显示取$min(A,C)$

#### 帧缓冲器与颜色
- 假定显示器分辨率$m\times n$ 需要同时显示k种颜色，则帧缓冲器的容量$v$至少为$v = m \times n \times \left \lceil \lg k \right \rceil$,同时$k = 2^{\dfrac{v}{m\times n}}$
- 缓冲器容量一定，分辨率越大，帧缓冲器每个单元可分配位长越小，同时画面可同时显示的颜色种类也越少。

#### 帧缓冲器结构
- 组合像素结构：像素所有位集中存储在单个存储器内
- 位平面结构：使用多个存储体，像素每一位各自存放在不同的存储体。
  - 位平面: 画面所有相同位像素存储在同一存储体内。

### 光栅扫描显示的彩色查找表
- 不增加帧缓冲器的容量来得到更多颜色。
- 彩色查找表或颜色索引技术

#### 彩色表结构
![](/images/documents/计算机图形学/彩色表.png)
- 一维线性表
  - 地址长度由帧缓冲器存储单元的位数决定
    - 确定一副画面能同时显示的颜色种类数
  - 每项元素对应一种颜色：元素位长可以由用户确定(可以依据帧缓冲器每个存储单元的基色数)
    - 决定显示器可显示的颜色种类数
  - 帧缓冲器每个单元存储的是：对应于某一像素的颜色地址，而非颜色值。
- 如果帧缓冲器单元位长每像素8位，彩色表每个元素(RGB三种颜色)单元位长4位
  - 彩色表地址长度: $2^8 = 256$个，即一幅画面可同时显示颜色数目
  - 彩色表元素位长：$3\times 4 = 12$位，则显示器可显示颜色种类数位$2^12$
- 彩色表只是扩大了可选择显示的颜色范围，而不能提高一幅画面上可以同时显示的颜色种类数。
  ![](/images/documents/计算机图形学/彩色表1.png)


### 随机扫描图形显示原理
- 随机扫描：按图形定义逐条绘制线条
  - 图形定义：一组画线命令
  - 扫描：显示处理器解释显示列表，并按次序绘制组成线条
    - <font color=red size=3>只在屏幕的图形部分绘制</font>(和光栅扫描很大的一个区别)
    - 扫描过程随图形定义的不同而不同
  - 刷新：刷新频率依赖于图形组成的线条数目

### 过程描述
- 基本指令
  - $P(x,y)$定位在点$(x,y)$
  - $S(z)$设置点$(x,y)$的亮度值为Z
- 图形定义：采用以线段或笔画为单位指令序列$S_i$来表示物体形状。
  - 如$S_1,S_2,\cdots,S_n$循环序列
- 显示过程：不断执行循环序列，当某一个物体的笔画发生变化时，只需要改变对应的指令序列

### 光栅扫描和随机扫描原理比较
- 随机扫描的图形定义是一组画线命令，直接按照路径画线，线条光滑。
- 光栅扫描的图形定义是所有屏幕像素点的颜色值，通过离散点集成画线，线条呈锯齿状。
- ![](/images/documents/计算机图形学/光栅和随机比较.png)
- 扫描刷新过程
  - 光栅扫描：刷新过程有固定程序，刷新频率和图形复杂度无关。
  - 随机扫描：依赖于图形构成定义
- 显示图形类型
  - 光栅扫描：容易绘制填充图形，色彩丰富
  - 随机扫描：适合线条组成的图形
- 光栅扫描的主要缺点
  - 几何表示图形显示时需要扫描转换，费时。
  - 存在直线段不直，图形边界阶梯状等

## 图形显示结构机理

### 阴极射线管结构机理
- 过程
  - 电子枪发出电子束
  - 聚焦系统聚焦和加速电极加速
  - 偏转系统控制射向涂覆荧光层的荧光屏的指定位置
  - 电子束冲击后产生一个亮点。
- 荧光粉层
  - 其颜色提供色彩显示机制
  - 余辉时间决定产生稳定画面所需的刷新频率
    - 短余辉时间用于动画
    - 长余辉时间用于高复杂静态图片
- 光点
  - 强度呈高斯分布
  - 两相邻光点可区分条件：间隔大于中心强度约$60\\%$ 处的点点直径
#### 色彩结构
- 黑白CRT:荧光物质只有一种，只需要控制电压值就可以得到不同灰度值。
- 彩色CRT:利用产生不同颜色光的荧光小点的颜色组合来显示。
- CRT产生彩色显示的结构有两种
  - 随机扫描：电子束穿透法(红绿荧光粉层)
    - 低速电子束：红光
    - 高速电子束：绿光
    - 中速电子束：两者组合
  - 光栅扫描：荫罩法(RGB三基色模型)

### 液晶显示器(平板显示设备)
- 发射显示器：将电能变成光，电子束以平行于屏幕的方向加速，而后偏转90°撞击屏幕
- 非发射显示器：利用光学效应将太阳光或者其它光源的光转换为图形图案。

#### 刷新控制
- 扭曲向列型(无源矩阵式)：液晶像素点由时序扫描信号直接驱动
- 薄膜晶体管型TFT(激活矩阵式)：液晶像素点由集成在其后的薄膜晶体管驱动.

### 数字墨水
- 显示机理：双稳定态
  - 负电场时白色颗粒漂浮到微小粒子顶部，表面呈现白光
  - 正电场时黑色颗粒漂浮到微小粒子顶部，表面呈现黑光
- 色彩机理：彩色滤光片+漂浮在屏幕上两类颗粒的数量
- 特点和优势
  - 极佳可读性
  - 极低能耗
  - 超便携性

### 三维图形立体感显示器
